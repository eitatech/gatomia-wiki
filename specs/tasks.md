# Implementation Plan

- [x] 1. Refactor CLI to separate analysis from documentation generation
  - Modify the CLI to split the current `generate` command into `analyze` (code analysis only) and `publish` (GitHub Pages)
  - This separates concerns: CLI handles analysis, GitHub Copilot agents handle documentation generation
  - _Requirements: 3.1, 3.2, 3.3, 6.1, 6.5_

- [x] 1.1 Add `gatowiki analyze` command
  - Create new CLI command that performs code analysis only (tree-sitter parsing, dependency graphs, module clustering)
  - Output: `module_tree.json`, `first_module_tree.json`
  - Does NOT generate documentation or call LLM APIs
  - Accept options: --repo-path, --output, --languages, --max-depth
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 1.2 Add `gatowiki publish` command
  - Create new CLI command for GitHub Pages publishing
  - Assumes documentation already exists (generated by agents)
  - Handles: HTML viewer generation, gh-pages branch creation, git operations
  - Accept options: --output, --github-pages, --create-branch
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 1.3 Simplify `gatowiki config` command
  - Remove API credential storage (no longer needed)
  - Keep only output directory configuration
  - Remove keychain integration
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 1.4 Remove `gatowiki generate` command
  - Remove the old generate command (replaced by analyze + Copilot agents + publish workflow)
  - Update CLI help text and documentation
  - _Requirements: 6.1, 6.5_

- [x] 2. Create GitHub Copilot orchestrator agent definition
  - Create markdown agent file that replaces the Python `agent_orchestrator.py` logic
  - Encode the orchestration logic for complex modules with sub-modules
  - Define how to use GitHub Copilot Chat API instead of direct Anthropic calls
  - _Requirements: 1.1, 1.3, 1.5, 6.1, 6.2, 9.1, 9.2, 9.4_

- [ ] 2.1 Create `.github/agents/gatowiki-orchestrator.agent.md`
  - Define agent purpose: orchestrate multi-module documentation generation
  - Document available tools: `gatowiki analyze`, file read/write operations, agent delegation
  - Encode orchestration logic: analyze module structure, decide processing strategy, process sub-modules, generate module docs
  - Include complexity threshold logic (> 10 components = complex)
  - Include recursive sub-module processing logic
  - Include state management via module_tree.json
  - _Requirements: 1.1, 1.5, 6.1, 6.2, 9.1, 9.2_

- [x] 2.2 Add example workflows to orchestrator agent
  - Add workflow: "Generate documentation for a complex module"
  - Add workflow: "Process module with sub-modules"
  - Add workflow: "Handle module tree updates"
  - Include error handling for each workflow
  - _Requirements: 9.3, 9.4_

- [x] 2.3 Add customization guidance to orchestrator agent
  - Explain how to modify complexity threshold
  - Explain how to adjust recursion depth
  - Explain how to customize documentation format
  - Include comments for common customization points
  - _Requirements: 9.5_

- [x] 3. Create GitHub Copilot leaf agent definition
  - Create markdown agent file that replaces the Python leaf agent logic
  - Encode the documentation generation logic for simple modules
  - Define how to read source code and generate documentation
  - _Requirements: 1.1, 1.3, 1.5, 6.1, 6.2, 9.1, 9.2_

- [ ] 3.1 Create `.github/agents/gatowiki-leaf.agent.md`
  - Define agent purpose: generate documentation for simple modules
  - Document available tools: file read/write operations, GitHub Copilot Chat API
  - Encode documentation generation logic: gather context, read source code, analyze interactions, generate docs, write files
  - Include documentation template structure
  - Include module tree update logic
  - _Requirements: 1.1, 1.5, 6.1, 6.2, 9.1, 9.2_

- [x] 3.2 Add example workflows to leaf agent
  - Add workflow: "Document a simple module"
  - Add workflow: "Generate component descriptions"
  - Add workflow: "Create architecture diagrams"
  - Include error handling for each workflow
  - _Requirements: 9.3, 9.4_

- [x] 3.3 Add documentation template to leaf agent
  - Define markdown template structure: Overview, Architecture, Components, Interactions, Dependencies, Usage Examples
  - Include Mermaid diagram examples
  - Specify required sections and optional sections
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 9.2_

- [x] 4. Create prompt template definitions
  - Create reusable prompt templates that both orchestrator and leaf agents can use
  - Define standardized templates for specific documentation tasks
  - _Requirements: 1.2, 9.2, 9.3_

- [ ] 4.1 Create `.github/prompts/gatowiki.prompt.md`
  - Create prompt template: Module Overview Generation
  - Create prompt template: Component Description
  - Create prompt template: Architecture Diagram
  - Create prompt template: Interaction Analysis
  - Create prompt template: Repository Overview
  - Specify required context and output format for each template
  - _Requirements: 1.2, 9.2, 9.3_

- [ ] 4.2 Add error handling guidance to prompts
  - Document common errors in prompt templates
  - Provide recovery strategies for API failures
  - Include retry logic guidance
  - _Requirements: 2.5, 3.5, 4.4_

- [x] 5. Remove Python agent orchestration code
  - Remove the pydantic-ai agent system that is being replaced by GitHub Copilot agents
  - Clean up imports and dependencies
  - _Requirements: 6.1, 6.3, 6.5_

- [x] 5.1 Remove `gatowiki/src/core/agent_orchestrator.py`
  - Delete the file that contains the AgentOrchestrator class
  - This logic is now encoded in `.github/agents/gatowiki-orchestrator.agent.md`
  - _Requirements: 6.1, 6.5_

- [x] 5.2 Remove `gatowiki/src/core/agent_tools/` directory
  - Delete `read_code_components_tool.py` (replaced by file read operations)
  - Delete `str_replace_editor_tool.py` (replaced by file write operations)
  - Delete `generate_sub_module_documentations.py` (replaced by agent delegation)
  - Delete `deps.py` (no longer needed)
  - _Requirements: 6.1, 6.5_

- [ ] 5.3 Remove `gatowiki/src/core/prompt_template.py`
  - Delete SYSTEM_PROMPT and LEAF_SYSTEM_PROMPT (replaced by agent definitions)
  - Delete format_user_prompt function (replaced by agent logic)
  - _Requirements: 6.1, 6.5_

- [ ] 5.4 Update imports in remaining files
  - Remove imports of deleted modules from `documentation_generator.py`
  - Remove imports of deleted modules from other files
  - Update any code that referenced the removed modules
  - _Requirements: 6.1, 6.5_

- [ ] 6. Remove LLM service layer completely
  - Remove all LLM API code since GitHub Copilot agents handle all LLM interactions through chat interface
  - Python code will only perform analysis and file operations, no LLM calls
  - _Requirements: 6.1, 6.5_

- [ ] 6.1 Remove `gatowiki/src/core/llm_services.py`
  - Delete the entire file - no LLM API calls needed
  - Python code does not call any LLM API (Anthropic, OpenAI, etc.)
  - All LLM interactions happen through GitHub Copilot Chat interface
  - _Requirements: 6.1, 6.5_

- [ ] 6.2 Remove LLM configuration from config model
  - Remove `base_url`, `main_model`, `cluster_model` from `gatowiki/cli/models/config.py`
  - Configuration no longer needs API credentials or model names
  - Only keep `default_output` setting
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 6.3 Remove LLM configuration from config manager
  - Remove API key storage from `gatowiki/cli/config_manager.py`
  - Remove keychain integration (no API keys needed)
  - Simplify config to only store output directory preference
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 6.4 Remove LLM configuration from backend Config
  - Remove `llm_base_url`, `llm_api_key`, `main_model`, `cluster_model`, `fallback_model` from `gatowiki/src/config.py`
  - Update `from_cli()` method to not require LLM parameters
  - _Requirements: 6.1, 6.5_

- [ ] 7. Update documentation generator to use new workflow
  - Modify `gatowiki/src/core/documentation_generator.py` to work with the new architecture
  - Remove agent orchestration calls, keep only analysis logic
  - _Requirements: 6.1, 6.5_

- [ ] 7.1 Simplify `documentation_generator.py`
  - Remove calls to `agent_orchestrator.process_module()`
  - Keep dependency analysis and module clustering logic
  - Update to only generate `module_tree.json` and `first_module_tree.json`
  - Remove documentation file generation (now handled by agents)
  - _Requirements: 6.1, 6.5_

- [ ] 7.2 Update CLI adapter
  - Modify `gatowiki/cli/adapters/doc_generator.py` to use new workflow
  - Update to call simplified documentation_generator
  - Remove progress tracking for doc generation (now handled by agents)
  - _Requirements: 6.1, 6.5_

- [ ] 8. Create integration documentation and migration guide
  - Write user-facing documentation explaining the new GitHub Copilot-based workflow
  - Create migration guide for users moving from Anthropic to GitHub Copilot
  - _Requirements: 9.1, 9.5_

- [ ] 8.1 Create migration guide
  - Create `docs/migration-to-github-copilot.md`
  - Explain breaking changes and why they were necessary
  - Provide step-by-step migration instructions
  - Include before/after workflow comparisons
  - Document configuration changes required
  - _Requirements: 9.1, 9.5_

- [ ] 8.2 Create GitHub Copilot integration guide
  - Create `docs/github-copilot-integration.md`
  - Explain how to set up GitHub Copilot API access
  - Document the new workflow: analyze → Copilot Chat → publish
  - Include examples of Copilot Chat interactions
  - Add troubleshooting section
  - _Requirements: 9.1, 9.4, 9.5_

- [ ] 8.3 Update README.md
  - Add prominent notice about GitHub Copilot requirement
  - Update quick start guide with new workflow
  - Link to migration guide and integration guide
  - Update architecture diagram
  - _Requirements: 9.1_

- [ ] 8.4 Create agent customization guide
  - Create `docs/customizing-agents.md`
  - Explain how to modify orchestrator agent behavior
  - Explain how to modify leaf agent behavior
  - Explain how to create custom prompt templates
  - Include examples of common customizations
  - _Requirements: 9.5_

- [x] 9. Checkpoint - Test new CLI commands
  - Ensure all tests pass, ask the user if questions arise
  - Test the new `analyze`, `config`, and `publish` commands

- [ ] 10. Test GitHub Copilot agents end-to-end ✅
  - Manually tested the complete workflow with GitHub Copilot Chat
  - ✅ Agents generate documentation correctly
  - ✅ Fixed module_tree.json generation (was empty)
  - ✅ Simplified agents to use natural language instructions
  - _Requirements: 1.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 10.1 Test orchestrator agent with complex module ✅
  - ✅ Fixed `cluster_modules()` to generate proper module structure
  - ✅ Agent now creates files directly (not printing to chat)
  - ✅ Simplified user prompts: just "Generate documentation"
  - ✅ Agent auto-runs `gatowiki analyze` if module_tree.json missing/empty
  - _Requirements: 1.5, 4.1, 4.2, 4.3_

- [ ] 10.2 Test leaf agent with simple module ✅
  - ✅ Leaf agent simplified and working
  - ✅ Agent reads source code correctly
  - ✅ Generates documentation with all required sections
  - ✅ Mermaid diagrams included
  - _Requirements: 1.5, 5.1, 5.2, 5.3, 5.4_

- [ ] 10.3 Test error handling ✅
  - ✅ Test with missing configuration (N/A - GitHub Copilot handles auth)
  - ✅ Test with invalid repository path (error: "Repository not found")
  - ✅ Test with empty repository (error: "No supported code files found")
  - ✅ Test with read-only file system (error: "Read-only file system")
  - ✅ Verify error messages are clear and actionable
  - ✅ Created automated test suite (automated-tests.sh) - all 7 tests passing
  - _Requirements: 2.5, 3.5, 4.4_

- [ ] 10.4 Test documentation querying
  - Generate documentation for a test repository
  - Ask Copilot Chat to show overview
  - Ask Copilot Chat about specific modules
  - Ask Copilot Chat about dependencies
  - Verify Copilot reads and presents information correctly
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 11. Write unit tests for new CLI commands
  - Create unit tests for the new `analyze`, `config`, and `publish` commands
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 7.1, 7.2, 7.3, 8.1_

- [ ] 11.1 Write unit tests for `analyze` command
  - Test with valid repository path
  - Test with invalid repository path
  - Test with various language filters
  - Test with various max-depth values
  - Verify module_tree.json is generated correctly
  - _Requirements: 3.1, 3.2, 3.3_

- [ ] 11.2 Write unit tests for modified `config` command
  - Test setting GitHub Copilot API credentials
  - Test showing configuration
  - Test validating configuration
  - Test keychain integration (mocked)
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 11.3 Write unit tests for `publish` command
  - Test GitHub Pages HTML generation
  - Test gh-pages branch creation
  - Test with uncommitted changes warning
  - Test with various output directories
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 8.1_

- [ ] 12. Write integration tests for complete workflow
  - Create integration tests that verify the end-to-end workflow
  - _Requirements: 2.1, 2.3, 3.1, 7.1, 7.2_

- [ ] 12.1 Write integration test for analyze → agents → publish workflow
  - Run `gatowiki analyze` on test repository
  - Simulate agent documentation generation (create mock docs)
  - Run `gatowiki publish --github-pages`
  - Verify complete workflow succeeds
  - _Requirements: 3.1, 7.1, 7.2_

- [ ] 12.2 Write integration test for configuration workflow
  - Test first-time setup with `config set`
  - Test configuration validation
  - Test configuration persistence
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 13. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise
